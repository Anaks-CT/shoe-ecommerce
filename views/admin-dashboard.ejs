<%- include('./layouts/adminheader.ejs') %> 

<h1 class="my-4">DASHBOARD</h1>
<div class="container">
    <div class="row">
        <div class="col-md-6 col-lg-3 my-2">
            <div class="p-5 rounded shadow bg-light d-flex flex-column justify-content-center align-items-center">
                <h3><b><%= customerCount.length  %></b></h3>
                <h5>Customers</h5>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 my-2">
            <div class="p-5 rounded shadow bg-light d-flex flex-column justify-content-center align-items-center">
                <h3><b><%= productCount.length %></b></h3>
                <h5>Products</h5>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 my-2">
            <div class="p-5 rounded shadow bg-light d-flex flex-column justify-content-center align-items-center">
                <h3><b><%= orderCount.length %></b></h3>
                <h5>Orders</h5>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 my-2">
            <div class="p-5 rounded shadow bg-light d-flex flex-column justify-content-center align-items-center">
                <h3><b>$<%= totalAmount %></b></h3>
                <h5>Order Amount</h5>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row d-flex justify-content-around">
      <div class="col-lg-9 col-12">
        <canvas id="myChart"></canvas>
      </div>
      <div class="col-lg-3 my-auto col-12">
        <canvas id="pieChart"></canvas>
      </div>
          
    </div>
</div>
<div id="tester"></div>

<!-- shahabas code -->

<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<div class="col-md-10 mx-auto my-3">
  <div class="row m-0">
      <div class="col-xl-3 col-lg-6 mb-2">
          <div class="card l-bg-cherry">
              <div class="card-statistic-3 p-4">
                  <div class="card-icon card-icon-large"><i class="fas fa-shopping-cart"></i></div>
                  <div class="mb-4">
                      <h5 class="card-title mb-0">Orders</h5>
                  </div>
                  <div class="row align-items-center mb-2 d-flex">
                      <div class="col-8">
                          <h4 class="d-flex align-items-center mb-0">
                            <%= orderCount.length %>
                          </h4>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="col-xl-3 col-lg-6 mb-2 ">
          <div class="card l-bg-blue-dark">
              <div class="card-statistic-3 p-4">
                  <div class="card-icon card-icon-large"><i class="fas fa-users"></i></div>
                  <div class="mb-4">
                      <h5 class="card-title mb-0">Customers</h5>
                  </div>
                  <div class="row align-items-center mb-2 d-flex">
                      <div class="col-8">
                          <h4 class="d-flex align-items-center mb-0">
                            <%= customerCount.length  %>
                          </h4>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="col-xl-3 col-lg-6 mb-2">
          <div class="card l-bg-green-dark">
              <div class="card-statistic-3 p-4">
                  <div class="card-icon card-icon-large"><i class="fas fa-clock"></i></div>
                  <div class="mb-4">
                      <h5 class="card-title mb-0">Products</h5>
                  </div>
                  <div class="row align-items-center mb-2 d-flex">
                      <div class="col-8">
                          <h4 class="d-flex align-items-center mb-0">
                            <%= productCount.length %>
                          </h4>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="col-xl-3 col-lg-6 mb-2">
          <div class="card l-bg-orange-dark">
              <div class="card-statistic-3 p-4">
                  <div class="card-icon card-icon-large"><i class="fas fa-dollar-sign"></i></div>
                  <div class="mb-4">
                      <h5 class="card-title mb-0">Revenue â‚¹</h5>
                  </div>
                  <div class="row align-items-center mb-2 d-flex">
                      <div class="col-8">
                          <h4 class="d-flex align-items-center mb-0">
                            <%= totalAmount %>
                          </h4>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="container">
  <h6 class="text-center my-2" >Sales Analytics - <%let currentYear = new Date();%>
    <%currentYear = currentYear.getFullYear();%><%=currentYear%></h6>
  <div class="row my-3" id="charts">
    <div class="col-lg-6">
      
      <canvas id="myChart"></canvas>
    </div>
    <div class="col-lg-6">
      <canvas id="myChart2"></canvas>
    </div>
  </div>
  <h6 class="text-center" >Order Status</h6>
  <div class="col-lg-4 mx-auto">
    <canvas id="myChart3"></canvas>
  </div>
</div>





<script>
    

       
</script>
<script>
  if ( window.history.replaceState ) {
 window.history.replaceState( null, null, window.location.href );
  }
</script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script>
      $(function () {
      $("#dataTable").DataTable({
        rowReorder: {
            selector: 'td:nth-child(2)'
        },
        responsive: true
    } );
    new $.fn.dataTable.FixedHeader( table );
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  if ( window.history.replaceState ) {
 window.history.replaceState( null, null, window.location.href );
  }
</script> -->


<script>
  const pie = document.getElementById('pieChart')
  $.ajax({
      url: "/adminDashboard",
      method: "PUT",
      success: (res) => {
        var orderData = res.data.orderData;
        let totalOrders = [];
        let revenuePerMonth = [];
        let avgBillPerOrder = [];
        let productsPerMonth = [];
        orderData.forEach((order) => {
          totalOrders.push(order.totalOrders);
          revenuePerMonth.push(order.revenue);
          avgBillPerOrder.push(order.avgBillPerOrder);
          productsPerMonth.push(order.totalProducts);
        });
        const ctx = document.getElementById("myChart");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: [
              "Jan",
              "Feb",
              "Mar",
              "Apr",
              "May",
              "Jun",
              "Jul",
              "Aug",
              "Sep",
              "Oct",
              "Nov",
              "Dec",
            ],
            datasets: [
              {
                label: "Revenue",
                data: revenuePerMonth,
                borderWidth: 1,
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                borderColor: "rgb(255, 99, 132)",
              },
              {
                label: "Avg. Bill per Order",
                data: avgBillPerOrder,
                borderWidth: 1,
                backgroundColor: "rgba(255, 159, 64, 0.2)",
                borderColor: "rgb(255, 159, 64)",
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });

      }})
      new Chart(pie, {
        type: 'doughnut',
        data:  {
        labels: [
        'Red',
        'Blue',
      ],
      datasets: [{
        label: 'My First Dataset',
        data: [45, 45],
        backgroundColor: [
          'rgb(255, 99, 132)',
          'rgb(54, 162, 235)',
        ],
        hoverOffset: 4
      }]
    },
      });


//   const anaks = 0
//   const bulbul = 5
//   const ctx = document.getElementById('myChart');
//   const pie = document.getElementById('pieChart')
//   new Chart(ctx, {
//     type: 'bar',
//     data: {
//   labels: ["January","February","March","April","May","June","July","August","September","October","November","December"],
//   datasets: [{
//     label: 'My First Dataset',
//     data: [65, 59, 80, 81, 56, 55, 40, 12, 78, 56, 45, 23],
//     backgroundColor: [
//       'rgba(255, 99, 132, 0.4)',
//       'rgba(255, 159, 64, 0.4)',
//       'rgba(255, 205, 86, 0.4)',
//       'rgba(75, 192, 192, 0.4)',
//       'rgba(54, 162, 235, 0.4)',
//       'rgba(153, 102, 255, 0.4)',
//       'rgba(201, 203, 207, 0.4)'
//     ],
//     borderColor: [
//       'rgb(255, 99, 132)',
//       'rgb(255, 159, 64)',
//       'rgb(255, 205, 86)',
//       'rgb(75, 192, 192)',
//       'rgb(54, 162, 235)',
//       'rgb(153, 102, 255)',
//       'rgb(201, 203, 207)'
//     ],
//     borderWidth: 1
//   }]
// },
//     options: {
//       scales: {
//         y: {
//           beginAtZero: true
//         }
//       }
//     }
//   });
//   
  
</script>
<!-- 
<script>
  const labels = Utils.months({count: 7});
const data = {
  labels: labels,
  datasets: [{
    label: 'My First Dataset',
    data: [65, 59, 80, 81, 56, 55, 40],
    backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
    borderWidth: 1
  }]
};
const config = new 
 {

  type: 'bar',
  data: data,
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    }
  },
};
</script> -->
<%- include('./layouts/adminfooter.ejs') %> 
